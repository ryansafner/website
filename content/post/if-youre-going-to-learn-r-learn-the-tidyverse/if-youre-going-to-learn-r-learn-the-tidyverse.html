---
title: "If You're Going to Learn R, Learn the Tidyverse"
author: "Ryan Safner"
date: "10/18/2019"
output: md_document
---



<p>This is an opinionated post based on how I teach <a href="http://metricsf19.classes.ryansafner.com">my undergraduate econometrics course</a>. It will not be for everybody. The title applies mostly to anyone who wants to do <a href="https://ryansafner.com/post/econometrics-data-science-and-causal-inference/">data science or econometrics</a> with R. This is the second time I have taught this course with R, and I have changed it around in many ways that I think optimize the process for students. In this post, I’ll cover just two major changes:</p>
<ol style="list-style-type: decimal">
<li>Learn R before the econometric/statistical theory</li>
<li>Learn <em>tidyverse</em> R, specifically</li>
</ol>
<p>The <a href="http://ryansafner.com/courses/econ480">last time I taught this course</a> (and my first exploration with R), I did neither. Part of this was because I had just learned base R a few months before the course began, and was still learning and discovering new commands as the semester went on. I waited several weeks to introduce R, starting instead with econometric theory and review, and then interspersing bits of R as it became relevant for each task (running regressions, making plots, changing variables, and various different models). While it was fine for most students, there are some changes that will make students’ lives easier.</p>
<p>I am still partway through the course, so it remains to be seen if students R skills are more developed by the end of the course (as they wrap up their projects) because they learned a lot of R <em>first</em>, versus in bite-sized chunks spread out over the semester.</p>
<div id="tidyverse-and-opinionated-r" class="section level2">
<h2><code>tidyverse</code> and Opinionated R</h2>
<blockquote>
<p>The tidyverse is an opinionated <a href="https://www.tidyverse.org/packages">collection of R packages</a> designed for data science. All packages share an underlying design philosophy, grammar, and data structures. - <a href="https://www.tidyverse.org/">tidyverse.org</a></p>
</blockquote>
<p>One of the common refrains about what is awesome/terrible about R is that there are multiple ways to accomplish the same task. Here is where the opinions begin, so I’ll give mine: Code written with tidyverse packages simply looks a lot better and is far easier for <em>humans</em> to read, particularly if you follow the <a href="https://style.tidyverse.org/">style guidelines</a>, as I do.</p>
<p>For example, the following code takes data from the excellent <a href="https://github.com/jennybc/gapminder">gapminder</a> dataset and package, and subsets the data to:</p>
<ol style="list-style-type: decimal">
<li>look only at U.S. observations</li>
<li>keep only the <code>year</code>, <code>gdpPercap</code> and <code>pop</code> variables</li>
<li>create a new variable called <code>GDP</code> by multiplying <code>gdpPercap</code> and <code>pop</code></li>
</ol>
<pre class="r"><code>gapminder1&lt;-gapminder[gapminder$country==&quot;United States&quot;, c(&quot;year&quot;, &quot;gdpPercap&quot;, &quot;pop&quot;)]

gapminder1$gdp&lt;-gapminder1$gdpPercap*gapminder1$pop</code></pre>
<p>This is doable in base R, and often requires saving the output as a new object for later use.</p>
<p>Below, the same procedure is done with <code>dplyr</code> and using the pipe <code>%&gt;%</code> from <code>magrittr</code> (both part of the <code>tidyverse</code>).</p>
<pre class="r"><code>gapminder %&gt;%
  filter(country == &quot;United States&quot;) %&gt;%
  select(year, gdpPercap, pop) %&gt;%
  mutate(GDP=gdpPercap * pop)</code></pre>
<pre><code>## # A tibble: 12 x 4
##     year gdpPercap       pop     GDP
##    &lt;int&gt;     &lt;dbl&gt;     &lt;int&gt;   &lt;dbl&gt;
##  1  1952    13990. 157553000 2.20e12
##  2  1957    14847. 171984000 2.55e12
##  3  1962    16173. 186538000 3.02e12
##  4  1967    19530. 198712000 3.88e12
##  5  1972    21806. 209896000 4.58e12
##  6  1977    24073. 220239000 5.30e12
##  7  1982    25010. 232187835 5.81e12
##  8  1987    29884. 242803533 7.26e12
##  9  1992    32004. 256894189 8.22e12
## 10  1997    35767. 272911760 9.76e12
## 11  2002    39097. 287675526 1.12e13
## 12  2007    42952. 301139947 1.29e13</code></pre>
<p>The beauty of <code>tidyverse</code> (particularly <code>dplyr</code>, which will be used the most for data wrangling) comes from a few features:</p>
<ol style="list-style-type: decimal">
<li>It uses active, common sense, natural language verbs to accomplish most of its tasks. <code>filter</code>, <code>select</code>, and <code>mutate</code> (among others) are easy to understand what is happening at each stage.</li>
<li>It allows use of the pipe <code>%&gt;%</code> to chain commands into a single sequence (and better yet, every time I use a pipe, I start a new line to make code far more readable).</li>
<li>It <em>shows</em> you the output by default and does not store (or overwrite) it anywhere until or unless you assign it to an object. This allows you to preview what your code does before you need to worry about saving it.</li>
</ol>
<p>Note that this can be done without use of the pipe, and by storing objects, as such:</p>
<pre class="r"><code>gapminder_US&lt;-filter(gapminder, country == &quot;United States&quot;)
gapminder_US&lt;-select(gapminder_US, year, gdpPercap, pop)
gapminder_US&lt;-mutate(gapminder_US, GDP=gdpPercap * pop)
gapminder_US</code></pre>
<pre><code>## # A tibble: 12 x 4
##     year gdpPercap       pop     GDP
##    &lt;int&gt;     &lt;dbl&gt;     &lt;int&gt;   &lt;dbl&gt;
##  1  1952    13990. 157553000 2.20e12
##  2  1957    14847. 171984000 2.55e12
##  3  1962    16173. 186538000 3.02e12
##  4  1967    19530. 198712000 3.88e12
##  5  1972    21806. 209896000 4.58e12
##  6  1977    24073. 220239000 5.30e12
##  7  1982    25010. 232187835 5.81e12
##  8  1987    29884. 242803533 7.26e12
##  9  1992    32004. 256894189 8.22e12
## 10  1997    35767. 272911760 9.76e12
## 11  2002    39097. 287675526 1.12e13
## 12  2007    42952. 301139947 1.29e13</code></pre>
<p><a href="http://varianceexplained.org/r/teach-tidyverse/">I am not alone in this view.</a> As far as it relates to teaching, the implications are clear: The overwhelming majority of students are new to “programming”, so they will be frustrated <em>regardless</em> of what order the content was taught, or in what flavor of language. They do not need to know the “base R” way of doing something just so that they can see that the tidyverse may be better or more efficient - they just need to learn <em>one</em> way to accomplish their task, it might as well be (what I think is) the “better” one.</p>
<p>So, I began the course (after two days of overview, why this course is important, useful, etc.) with 4 intensive classes of learning R, and tidyverse specifically. First, a day about base R, second, a day about ggplot2 for data visualization, third, a day of data wrangling with tidyverse, and finally a day about workflow and other tools (mainly r markdown). I cover the basics behind each of them, and what I have learned, below:</p>
</div>
<div id="class-1-is-base-r-necessary" class="section level2">
<h2>Class 1: Is Base R Necessary?</h2>
<p>It somehow seems more “pure” to teach R from the ground up: First we discuss basic R commands, then we build more complicated functions in, then we show how to manipulate data, then we show how to plot, and later: “oh by the way there are these packages that do all of this more elegantly and in half as many lines of code.” That is how I taught econometrics last year.</p>
<p>We need to remember this is a class in econometrics and data analysis that <em>uses</em> R, not a class in computer science or the R language. In fact, people with a computer science/programming background seem to find R <a href="https://www.youtube.com/watch?v=6S9r_YbqHy8&amp;feature=youtu.be">particularly annoying as a programming language</a>. It is highly domain-specific (that domain chiefly being statistics), and should be appreciated as such.</p>
<p>In any case, I still made a point this year to make <a href="https://metricsf19.classes.ryansafner.com/class/03-class/">my first R-based class</a> entirely about Base R without the bells and whistles.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Students and R-users need to understand some basic syntax of functions, as well as the object-oriented nature of the language. I made sure that they understand the following really well:</p>
<ol style="list-style-type: decimal">
<li>What are packages, how to find, install, and load them.</li>
<li>How to get help in R and on the internet for R functions.</li>
<li>Different types of objects: especially <code>vector</code> and <code>data.frame</code></li>
<li>Different data classes: especially <code>numeric</code> and <code>character</code>, and how to check them</li>
<li>Some basic functions for making vectors and for getting statistics (<code>c()</code>, <code>mean()</code>, <code>sd()</code>, etc.)</li>
<li>The basics of data frames: recognizing each column is a vector, how to summarize them, how to subset by row, column, and element</li>
</ol>
<p>I try not to go overboard (I omit things like <code>factor</code> and <code>logical</code> classes, <code>list</code> or <code>matrix</code> objects) and tell them not to worry too much about manipulating dataframes in Base R, as that is what <code>tidyverse</code> will accomplish much more intuitively and efficiently.</p>
</div>
<div id="class-2-data-visualization-with-ggplot2" class="section level2">
<h2>Class 2: Data Visualization with <code>ggplot2</code></h2>
<p>The <a href="https://metricsf19.classes.ryansafner.com/class/04-class/">second R-class</a> I taught students all about data visualization with <code>ggplot2</code>. Not only do I think it is aesthetically superior to anything from Base R,<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> it also allows students to think about the important elements of a plot, and optimize each one accordingly, with the “grammar of graphics.” This is a pretty steep learning curve compared to typing <code>plot(y,x)</code> and seeing a scatterplot appear, but in the end, it is worth it.</p>
<p>In class, I build a few plots layer by layer:</p>
<ol style="list-style-type: decimal">
<li><code>data</code></li>
<li><code>aes</code>thetics</li>
<li><code>geom</code>etric objects</li>
<li><code>facets</code></li>
<li><code>labels</code></li>
<li><code>scale</code>s</li>
<li><code>theme</code></li>
</ol>
<p>At each layer, I explain what each layer does and many of the possibilities for each layer.</p>
<pre class="r"><code>ggplot(data = mpg)+
  aes(x = displ,
        y = hwy)+
  geom_point(aes(color = class))+
  geom_smooth()+
  facet_wrap(~year)+
  labs(x = &quot;Engine Displacement (Liters)&quot;,
       y = &quot;Highway MPG&quot;,
       title = &quot;Car Mileage and Displacement&quot;,
       subtitle = &quot;More Displacement Lowers Highway MPG&quot;,
       caption = &quot;Source: EPA&quot;,
       color = &quot;Vehicle Class&quot;)+
  scale_color_viridis_d()+
  theme_minimal()+
  theme(text = element_text(family = &quot;Fira Sans&quot;),
        legend.position=&quot;bottom&quot;)</code></pre>
<p><img src="/post/if-youre-going-to-learn-r-learn-the-tidyverse/if-youre-going-to-learn-r-learn-the-tidyverse_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>This is also the students’ first exposure to <code>tidyverse</code>, though it is not yet apparent. My one regret, in retrospect, is that plot layers are combined with <code>+</code> instead of <code>%&gt;%</code>.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> After learning other <code>tidyverse</code> packages such as <code>dplyr</code>, students would try to add plot layers with <code>%&gt;%</code> but I would continuously have to remind them that layers are combined with <code>+</code>.</p>
<p>Recall, all of this is done well before we cover basic statistics or econometric theory. When I was teaching students <em>how</em> to construct various plots with <code>ggplot2</code>, this was before they knew <em>why</em> they needed a scatterplot or a boxplot.</p>
</div>
<div id="class-3-data-wrangling-with-tidyverse-mostly-dplyr" class="section level2">
<h2>Class 3: Data Wrangling with <code>tidyverse</code> (mostly <code>dplyr</code>)</h2>
<p>The <a href="https://metricsf19.classes.ryansafner.com/class/05-class/">third class</a> was all about <code>tidyverse</code> as a unifying set of packages with a common philosophy and grammar. I did discuss several core packages:</p>
<ol style="list-style-type: decimal">
<li><code>tibble</code> for friendlier dataframes<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></li>
<li><code>magrittr</code> for using the pipe <code>%&gt;%</code> to chain code together</li>
<li><code>readr</code> for importing data (mostly <code>.csv</code><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></li>
<li><code>tidyr</code> for reshaping data</li>
</ol>
<p>But the primary focus was on <code>dplyr</code> and its verbs:</p>
<ol style="list-style-type: decimal">
<li><code>filter()</code> to keep selected observations</li>
<li><code>select()</code> to keep selected variables</li>
<li><code>arrange()</code> to reorder observations by a value</li>
<li><code>mutate()</code> to create new variables</li>
<li><code>summarize()</code> to create summary statistics</li>
<li><code>group_by()</code> for performing operations by group</li>
</ol>
<p>We worked with gapminder data to accomplish a wide variety of tasks using these commands.</p>
</div>
<div id="class-4-optimizing-workflow-r-projects-and-markdown" class="section level2">
<h2>Class 4: Optimizing Workflow: R Projects and Markdown</h2>
<p>The <a href="https://metricsf19.classes.ryansafner.com/class/06-class/">fourth and final class</a> dedicated to R was all about optimizing workflow with a few tweaks. I have not used Microsoft Office products in about 10 years (more posts to come later), and in the last year, have migrated <strong>ALL</strong> of my document-preparation (that’s research papers, teaching materials, exams, slides, websites, <em>everything</em>) to markdown files I write inside of R Studio and track with version control on GitHub.</p>
<p>When I show to students that there are other options to Microsoft Word and Powerpoint, their jaws drop, particularly when I show all that you can do with a single plain-text document (integrating text, code, commands, plots, citations and bibliography etc) that exports to pdf, html, slides, and other output. Last semester, after I showed them <code>R Markdown</code>, several students told me it was the best thing about the class, and some still use it for other assignments in other classes on their own. This deserves its own series of posts, so for now I will focus on the two or three things I tried to teach students <em>in addition</em> to how to use Markdown.</p>
<p>First, <strong>R Projects</strong> are absolutely essential. I discovered these late in the game last year, but now realized that they solve far more problems than trying to do without them.</p>
<p>The #1 unnecessary problem I encounter with students is trying to load data from external sources. The world is not full of tidy pre-cleaned data, or even data that only come in <code>.csv</code> formats. <code>tidyr</code> is great for that, and so is <code>readr</code>, but the problem actually is one of basic file operations on a computer: students (and R) don’t know where the data is saved on their computers! Rather than trying to teach them how to write out relative or absolute file paths to locate files on their computer, R Projects solve this problem by setting the default working directory to the folder where the project is stored on their computer. That means that if you store the data file in that folder, you only need to load it (with <code>readr</code> or equivalent) with (e.g.) <code>read_csv("thedata.csv"</code>), no more worrying about file paths!</p>
<p>I also encourage students to create a logical folder hierarchy within their projects, similar to what I show in <a href="https://github.com/ryansafner/workflow">this repository</a>.</p>
<p>Second, <strong>version control</strong> with Github. I never actually got around to showing this in class, but a number of students expressed interest in learning how to do this. I feel it’s a bit advanced and requires a bit more computing expertise (but not too much, since I’m able to pull it off!), but I use it constantly. Perhaps more posts on this later.</p>
<p>In any case, after teaching these workflow methods, looking back on the first 3 R classes, I am tempted to just start from scratch with projects and markdown and make students use them from the beginning. Perhaps next year.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Though I allude to more complex examples to give them a taste of what’s to come!<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>If it was not clear in my posts by now, I have high aesthetic standards.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I believe this is due to the unique history of <code>ggplot2</code> coming before the <code>tidyverse</code> was a full idea. Though I hear in future versions, this may be fixed!<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>I simply replaced all dataframes in the course with tibbles<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>And derivative packages such as <code>readxl</code> and <code>haven</code> for importing other types of data such as <code>.xlsx</code> or Stata’s <code>.dat</code>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
